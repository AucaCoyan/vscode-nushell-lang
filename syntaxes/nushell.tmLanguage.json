{
    "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
    "name": "nushell",
    "scopeName": "source.nushell",
    "patterns": [
        { "include": "#define-variable" },
        { "include": "#define-alias" },
        { "include": "#expression" },
        { "include": "#string" },
        { "include": "#comment" }
    ],
    "repository": {
        "string": {
            "patterns": [
                { "include": "#string-single-quote" },
                { "include": "#string-backtick" },
                { "include": "#string-double-quote" },
                { "include": "#string-interpolated-double" },
                { "include": "#string-interpolated-single" },
                { "include": "#string-bare" }
            ]
        },
        "string-escape": {
            "match": "\\\\(?:[bfrnt\\'\"/]|u[0-9a-fA-F]{4})",
            "name": "constant.character.escape.nushell"
        },
        "paren-expression": {
            "begin": "\\(",
            "beginCaptures": {
				"0": { "name": "meta.brace.round.begin.nushell" }
			},
            "end": "\\)",
            "endCaptures": {
				"0": { "name": "meta.brace.round.end.nushell" }
			},
            "name": "meta.expression.braced.nushell",
            "patterns": [
                { "include": "#expression" }
            ]
        },
        "string-bare": {
            "match": "\\w[\\w-]+",
            "name": "string.bare.nushell"
        },
        "string-single-quote": {
            "begin": "'",
            "beginCaptures": {
				"0": { "name": "punctuation.definition.string.begin.nushell" }
			},
            "end": "'",
            "endCaptures": {
				"0": { "name": "punctuation.definition.string.end.nushell" }
			},
            "name": "string.quoted.single.nushell"
        },
        "string-backtick": {
            "begin": "`",
            "beginCaptures": {
				"0": { "name": "punctuation.definition.string.begin.nushell" }
			},
            "end": "`",
            "endCaptures": {
				"0": { "name": "punctuation.definition.string.end.nushell" }
			},
            "name": "string.quoted.single.nushell"
        },
        "string-double-quote": {
            "begin": "\"",
            "beginCaptures": {
				"0": { "name": "punctuation.definition.string.begin.nushell" }
			},
            "end": "\"",
            "endCaptures": {
				"0": { "name": "punctuation.definition.string.end.nushell" }
			},
            "name": "string.quoted.double.nushell",
            "patterns": [
                {"include": "#string-escape"}
            ]
        },
        "string-interpolated-double": {
            "begin": "\\$\"",
            "beginCaptures": {
				"0": { "name": "punctuation.definition.string.begin.nushell" }
			},
            "end": "\"",
            "endCaptures": {
				"0": { "name": "punctuation.definition.string.end.nushell" }
			},
            "name": "string.interpolated.double.nushell",
            "patterns": [
                {
                    "match": "\\\\[()]",
                    "name": "constant.character.escape.nushell"
                },
                {"include": "#string-escape"},
                {"include": "#paren-expression"}
            ]
        },
        "string-interpolated-single": {
            "begin": "\\$'",
            "beginCaptures": {
				"0": { "name": "punctuation.definition.string.begin.nushell" }
			},
            "end": "'",
            "endCaptures": {
				"0": { "name": "punctuation.definition.string.end.nushell" }
			},
            "name": "string.interpolated.single.nushell",
            "patterns": [
                {"include": "#paren-expression"}
            ]
        },
        "comment": {
          "match": "(#.*)$",
          "name": "comment.nushell"
        },
        "keyword": {
            "match": "(?:def(?:-env)?)",
            "name": "keyword.other.nushell"
        },
        "parameters": {
            "match": "\\b--[\\w-]*|-\\w*",
            "name":"variable.parameter.nushell"
        },
        "variables": {
            "match": "(\\$[a-zA-Z0-9_]+)(?:\\.\\w+)*",
            "captures": {
                "1": { "name": "constant.language" }
            },
            "name":"variable.name.nushell"
        },
        "command-name": {
            "match": "(\\^?)(\\w+(?:\\-+\\w+)*)",
            "captures": {
                "1": { "name": "keyword.operator.nushell" },
                "2": { "name":"source.nushell" }
            }
        },
        "numbers": {
            "match": "\\d+(?:\\.\\d*)?(?i:ns|us|ms|sec|min|hr|day|wk|b|kb|mb|gb|tb|pt|eb|zb|kib|mib|gib|tib|pit|eib|zib)?\\b",
            "name": "constant.numeric.nushell"
        },
        "binary": {
            "begin": "\\b(0x)(\\[)",
            "beginCaptures": {
                "1": { "name": "constant.numeric.nushell" },
                "2": { "name": "meta.brace.square.begin.nushell" }
            },
            "end": "\\]",
            "endCaptures": {
                "0": { "name": "meta.brace.square.begin.nushell" }
            },
            "name": "constant.binary.nushell",
            "patterns": [
                { "match": "[0-9a-fA-F]{2}", "name": "constant.numeric.nushell" }
            ]
        },
        "table": {
            "begin": "\\[",
            "beginCaptures": {
                "0": { "name": "meta.brace.square.begin.nushell" }
            },
            "end": "\\]",
            "endCaptures": {
                "0": { "name": "meta.brace.square.end.nushell" }
            },
            "name": "meta.table.nushell",
            "patterns": [
                { "include": "#inline-expression" }
            ]
        },
        "record": {
            "begin": "\\{",
            "beginCaptures": {
                "0": { "name": "punctuation.definition.record.begin.nushell" }
            },
            "end": "\\}",
            "endCaptures": {
                "0": { "name": "punctuation.definition.record.begin.nushell" }
            },
            "name": "meta.record.nushell",
            "patterns": [
                { 
                    "match": "(\\w+):",
                    "captures": {
                        "1": { "name": "variable.other.nushell" }
                    }
                }
            ]
        },
        "braced-expression": {
            "begin": "(\\{)(?:\\|((?:(?:\\w+)\\s*)*)\\|)?",
            "beginCaptures": {
				"1": { "name": "punctuation.section.block.begin.bracket.curly.nushell" },
                "2": { 
                    "patterns": [
                        {
                            "match": "\\w+",
                            "name": "variable.parameter.nushell"
                        }
                    ]
                 }
			},
            "end": "\\}",
            "endCaptures": {
				"0": { "name": "punctuation.section.block.end.bracket.curly.nushell" }
			},
            "name": "meta.expression.braced.nushell",
            "patterns": [
                { "include": "#expression" }
            ]
        },
        "define-variable": {
            "match": "(let(?:-env)?|mut|const)\\s+(\\w+)\\s*(=)",
            "captures": {
                "1": { "name": "keyword.other.nushell" },
                "2": { "name": "variable.other.nushell" },
                "3": { "name": "keyword.operator.nushell" }
            }
        },
        "define-alias": {
            "match": "(alias)\\s+(\\w+)\\s*(=)",
            "captures": {
                "1": { "name": "keyword.other.nushell" },
                "2": { "name": "entity.name.function" },
                "3": { "name": "keyword.operator.nushell" }
            }
        },
        "command": {
            "begin": "(?:(\\^)|(?![0-9]))(\\w+(?:\\-+\\w+)*)",
            "beginCaptures": {
                "1": { "name": "keyword.operator.nushell" },
                "2": { "name":"entity.name.function" }
            },
            "end": "(?=\\||\\)|\\})|$",
            "name": "meta.expression.nushell",
            "patterns": [
                { "include": "#inline-expression" }
            ]
        },
        "expression": {
            "patterns": [
                { "include": "#command" },
                { "include": "#inline-expression" }
            ]
        },
        "inline-expression": {
            "patterns": [
                { "include": "#parameters" },
                { "include": "#variables" },
                { "include": "#numbers" },
                { "include": "#binary" },
                { "include": "#table" },
                { "include": "#string" },
                { "include": "#paren-expression" },
                { "include": "#braced-expression" }
            ]
        }
    }
}